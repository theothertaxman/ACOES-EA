<?xml version="1.0" encoding="UTF-8"?>
<ui:composition template="/WEB-INF/templates/dashboard.xhtml"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
    
    <ui:param name="must_be_logged_in" value="true"></ui:param>
    <ui:param name="admin_only" value="true"></ui:param>
    
    <ui:define name="title">
        ACOES - Dashboard
    </ui:define>

    <ui:define name="content">
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"/>
            <style>
                table{
                     font-family: arial, sans-serif;
                     border-collapse: collapse;
                     width: 100%;
                 }
                 * {
                     box-sizing: border-box;
                 }
                 td, th {
                     border: 1px solid #dddddd;
                     text-align: left;
                     padding: 8px;
                 }
                 tr:nth-child(even) {
                     background-color: #dddddd;
                 }
                 form.example input[type=text] {
                     padding: 7px;
                     font-size: 17px;
                     border: 1px solid grey;
                     float: left;
                     width: 50%;
                     background: #f1f1f1;
                 }
                 form.example button {  
                     float: left;
                     width: 8%;
                     padding: 7px;
                     background: #2196F3;
                     color: white;
                     font-size: 17px;
                     border: 1px solid grey;
                     border-left: none;
                     cursor: pointer;
                 }
                 form.example button:hover {
                     background: #0b7dda;
                 }
            </style>
            
            <c:choose>
                <c:when test="#{sessionControl.lang == 'ENGLISH'}">
                    <c:set var="h_title" value="Dashboard"/>
                    <c:set var="no_payments_msg" value="There are no payments."/>
                    <c:set var="concept" value="Concept"/>
                    <c:set var="income" value="Income ($/Quota)"/>
                    <c:set var="payment_method" value="Payment Method"/>
                    <c:set var="timestame_col" value="Timestamp"/>
                    <c:set var="total_amount" value="Total amount"/>
                    <c:set var="num_benefactors" value="Number of benefactors"/>
                </c:when>
                <c:when test="#{sessionControl.lang == 'SPANISH'}">
                    <c:set var="h_title" value="Dashboard"/>
                    <c:set var="no_payments_msg" value="No se han encontrado pagos."/>
                    <c:set var="concept" value="Concepto"/>
                    <c:set var="income" value="Cuantía ($/Cuota)"/>
                    <c:set var="payment_method" value="Método de pago"/>
                    <c:set var="timestame_col" value="Fecha"/>
                    <c:set var="total_amount" value="Total"/>
                    <c:set var="num_benefactors" value="Número de benefactores"/>
                </c:when>
            </c:choose>
            
            <h3>Dashboard</h3>
            <hr/>
            <c:set var="paymentsStats" value="#{sessionControl.paymentsServices.getStats()}" scope="request" />
            
            <c:choose>
                <c:when test="#{paymentsStats.getPayments().isEmpty()}">
                    #{no_payments_msg}
                </c:when>
                <c:otherwise>
                    <h:dataTable id="table" value="#{paymentsStats.getPayments()}" var="entry">
                        <h:column>
                            <f:facet name="header">#{concept}</f:facet>
                            <h:outputText value="#{entry.concept}"/>
                        </h:column>
                        <h:column>
                            <f:facet name="header">#{income}</f:facet>
                            <h:outputText value="#{entry.amount}"/>
                        </h:column>
                        <h:column>
                            <f:facet name="header">#{payment_method}</f:facet>
                            <h:outputText value="#{entry.paymentMethod}"/>
                        </h:column>

                        <h:column>
                            <f:facet name="header">#{timestamp_col}</f:facet>
                            <h:outputText value="#{entry.timestamp}"/>
                        </h:column>
                        <h:column>
                            <f:facet name="header">Benefactor</f:facet>
                            <h:outputText value="#{entry.benefactor.email}"/>
                        </h:column>
                    </h:dataTable>
                <p></p>
                <b>#{total_amount}:</b> <h:outputText value=" $#{paymentsStats.totalAmount()}"></h:outputText><br/>
                <b>#{num_benefactors}:</b> <h:outputText value=" #{paymentsStats.numberOfBenefactors()}"></h:outputText>

                </c:otherwise>
            </c:choose>
    </ui:define>
</ui:composition>
